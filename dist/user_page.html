<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/user.css">
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  <script defer src="./bundle.js"></script>

  <title>Garbo Monitoring</title>
  <link rel="icon" type="image/x-icon" href="assets/img/logo/logo.png">
</head>


<body>
  <main>
    <div class="box" style="margin-left: 16%;">
    <div class="inner-box">
      <div class="menu">
        <div class="profile-tab-nav" style="border-right: 1px solid #137413;">
					<div style="padding: 10%;">

						<div class="img-circle" style="margin-bottom: 13%; text-align: center;">
							<img src="assets/img/side-img/profile-pic.png" class="shadow">
						</div>
						<h4 class="uname" id="displayName" style="text-align: center;"></h4>
					</div>

					<div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
						
						<a class="nav-link" id="user-tab" data-toggle="pill" href="#user" role="tab" aria-controls="user" aria-selected="true">
              <img width="22" height="22" src="https://img.icons8.com/external-kiranshastry-lineal-kiranshastry/22/137413/external-user-interface-kiranshastry-lineal-kiranshastry.png" class="text-center mr-1"/> <span>Profile</span>
						</a>

						<a class="nav-link" id="password-tab" data-toggle="pill" href="#password" role="tab" aria-controls="password" aria-selected="false">
              <img width="22" height="22" src="https://img.icons8.com/ios/22/137413/private2.png" class="text-center mr-1"/> <span>Password</span>
						</a>

            <a class="nav-link show-modal" id="deact" data-toggle="pill" href="#deact" role="tab" aria-controls="password" aria-selected="false">
              <img width="22" height="22" src="https://img.icons8.com/external-creatype-glyph-colourcreatype/22/137413/external-people-creatype-user-interface-creatype-glyph-colourcreatype.png" class="text-center mr-1"/> <span>Delete Account</span>
						</a>
					</div>
				</div>

        <p>Â© Garbo Monitoring. A product of IoT project 2023</p>
      </div>

      <div class="form-menu">

        <div class="tab-content p-4 p-md-3" id="v-pills-tabContent">

          <div class="user tab-pane fade show active" id="user" role="tabpanel" aria-labelledby="user-tab">

          <h2 class="mb-4">Profile Settings</h2>

          <div class="btns">
            <a href="home.html" class="btn btn-prev">
              <img width="36" height="36" src="https://img.icons8.com/ios-filled/36/137413/login-rounded.png" alt="login-rounded"/>
            </a>
          </div>

          <form  autocomplete="off">

            <signage class="title">Fullname</signage>
            <input type="text" id="name" class="input"  required="required">

            <signage class="title">Address</signage>

            <div class="inputrow">
              <select class="inputgroup select" id="barangay">
          
                <ul class="options" style="position: absolute;font-size: 0.75em;">

                  <option selected disabled>Barangay</option>

                    <option class="option" required="required">
                      <img width="16" height="16" src="https://img.icons8.com/sf-black-filled/16/137413/home.png" alt="home"/>
                        <span class="option-text">Bagong Silang</span> <!--Schedule: Thursday-->
                    </option>
                    <option class="option">
                      <img width="16" height="16" src="https://img.icons8.com/sf-black-filled/16/137413/home.png" alt="home"/>
                        <span class="option-text">Del Carmen</span> <!--Schedule: Thursday and Tuesday-->
                    </option>
                    <option class="option">
                      <img width="16" height="16" src="https://img.icons8.com/sf-black-filled/16/137413/home.png" alt="home"/>
                        <span class="option-text">Saray</span> <!--Schedule: Tuesday and Friday-->
                    </option>

                    <option class="option">
                      <img width="16" height="16" src="https://img.icons8.com/sf-black-filled/16/137413/home.png" alt="home"/>
                        <span class="option-text">Tominobo Proper</span> <!--Schedule: Tuesday and Friday-->
                    </option>

                    <option class="option">
                      <img width="16" height="16" src="https://img.icons8.com/sf-black-filled/16/137413/home.png" alt="home"/>
                        <span class="option-text">Ubaldo Laya</span> <!--Schedule: Tuesday-->
                    </option>
                </ul>
              </select>
              
              <div class="input-text select-menu">
                <div class="select-btn">
                  <input type="text" id="purok" placeholder="Purok" class="input"  required="required">
                </div>
              </div>
            </div>

            <signage class="title">Email</signage>
            <input type="email" id="email" class="input"  required="required">

            <signage class="title">Phone Number</signage>
            <input type="number" id="phone" class="input"  required="required">

            <input type="submit" value="Save Changes" id="editButton" class="save" />
          </form>
          </div>

          <!--password page-->
          <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
						<h2 class="mb-4">Password Settings</h2>

            <div class="btns">
              <a href="home.html" class="btn btn-prev">
                <img width="36" height="36" src="https://img.icons8.com/ios-filled/36/137413/login-rounded.png" alt="login-rounded"/>
              </a>
            </div>
  
            <form action="" autocomplete="off">
     	
     	        <signage class="title mb-1">Old Password</signage>
     	        <input class="inputp" type="password" name="op" placeholder="Old Password"><br>

              <signage class="title mb-1">New Password</signage>
              <input class="inputp" type="password" name="np" placeholder="New Password"><br>

              <signage class="title mb-1">Confirm New Password</signage>
              <input class="inputp" type="password" name="c_np" placeholder="Confirm New Password"><br>
  
              <input type="submit" value="Save Password" id="editButton1" class="save">
            </form>
						
					</div>
        </div>
      </div>

      <section id="deact" aria-labelledby="deact">

        <span class="overlay"></span>
        <div class="modal-box">

          <img width="70" height="70" src="https://img.icons8.com/ios/70/137413/nerd--v1.png" alt="nerd--v1"/>

          <h2>Are you sure you want to leave?</h2>
          <h4>Note: All your information will not be restored.</h4>

          <div class="buttons">
            <button class="close-btn">Cancel</button>
            <button class="deactivate bg-danger" id="delAccount">Delete Account</button>
          </div>
        </div>
        
      </section>

    </div>
  </div>
  </main>
  
  

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="https://unpkg.com/scrollreveal"></script>
  <script src="./js/user.js"></script>
</body>
</html>


<script type="module">  

  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-app.js";
  import { getAuth, signOut, onAuthStateChanged, updateProfile, updateEmail, deleteUser } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-auth.js";
  import { connectFirestoreEmulator, orderBy, limit, getFirestore, setDoc, addDoc, doc, updateDoc,deleteDoc, getDoc, query, collection, where, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/9.19.0/firebase-firestore.js";
  
  
  
  const firebaseConfig = {
    apiKey: "AIzaSyBAO-FP4MGApI231xr9bVDZIzsXPPGoVkM",
    authDomain: "casestudy2-f35ed.firebaseapp.com",
    projectId: "casestudy2-f35ed",
    storageBucket: "casestudy2-f35ed.appspot.com",
    messagingSenderId: "1047601609844",
    appId: "1:1047601609844:web:55b8874e5ccf521466a521",
    measurementId: "G-9XV7B6DX8J"
};

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore();
  console.log(app);


//-----------------------------------------------------Profile username and Profile Photo
onAuthStateChanged(auth, (user) => {
  if (user) {
    console.log("Authenticated user:", user);
    const displayName = user.displayName;
    const displayNameElement = document.getElementById("displayName");
    displayNameElement.textContent = displayName;

    // Check if the user has a profile photo URL
    if (user.photoURL) {
      const profilePhotoElement = document.querySelectorAll("#profile-photo");
      profilePhotoElement.forEach((element) => {
        element.src = user.photoURL;
      });
    }
  } else {
    console.log("User is not authenticated");
  }
});


document.getElementById("editButton").addEventListener("click", async function() {
      var username = document.getElementById("name").value;
      var address = document.getElementById("barangay").value;
      var purok = document.getElementById("purok").value;
      var email = document.getElementById("email").value;
      var contact = document.getElementById("phone").value;

      try {
        await updateProfile(auth.currentUser, {
          displayName: username});

        updateEmail(auth.currentUser, {
          email: email
        });

        const collectionRef = collection(db, 'users');
        const queryRef = query(collectionRef);

        onAuthStateChanged(auth, (user) => {
          if (user) {
            const userId = user.uid;
            console.log(user);

            const docRef = doc(collectionRef, userId);
            getDoc(docRef)
              .then(async (snapshot) => {
                if (snapshot.exists()) {
                  await setDoc(docRef, {
                    name: username,
                    barangay: address,
                    purok: purok,
                    email: email,
                    phone: contact
                  });
                }
              });
          }
        });

      } catch (error) {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.log(errorMessage);
        alert(errorMessage);
      }
    });

// ------------------------------------------------------ Delete Account


const user = auth.currentUser;

document.getElementById("editButton").addEventListener("click", async function() {
  deleteUser(user).then(() => {
    // User deleted.
  }).catch((error) => {
    // An error ocurred
    // ...
  });

 



    </script>